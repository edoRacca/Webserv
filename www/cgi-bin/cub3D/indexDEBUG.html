<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>cub3D HUD - Light Version</title>
    <style>
        body { margin: 0; background: #0b0f12; font-family: monospace; color: #c7d5e0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .game-wrapper { display: grid; grid-template-columns: 120px auto 120px; gap: 20px; align-items: center; }
        .screen-container { padding: 10px; background: linear-gradient(145deg, #1a2228, #0d1318); border: 4px solid #2a3942; box-shadow: 0 0 25px #000; }
        #screen { display: block; width: 640px; height: 480px; image-rendering: pixelated; }
        button { background: #1a2228; border: 2px solid #2a3942; color: #c7d5e0; padding: 10px; cursor: pointer; transition: 0.1s; width: 100%; }
        button:hover { background: #2a3942; box-shadow: 0 0 8px #00ffcc; }
    </style>
</head>
<body>

<div class="game-wrapper">
    <div></div> <div class="screen-container">
        <img id="screen" src="/render.bmp" alt="Waiting for render...">
    </div>

    <div style="text-align: center;">
        <p>Status: <span id="status" style="color: #00ffcc;">Connecting</span></p>
        <button onclick="location.reload()">Reload Page</button>
    </div>
</div>

<script>
    const screenImg = document.getElementById("screen");
    const statusText = document.getElementById("status");
    
    // Configurazione
    const REFRESH_RATE = 100; // Millisecondi tra un frame e l'altro (10 FPS)
    const IMAGE_URL = "/render.bmp";

    function updateFrame() {
        // Creiamo un oggetto immagine "nascosto" per pre-caricare il file
        const nextFrame = new Image();
        
        // Quando l'immagine è caricata con successo dal server
        nextFrame.onload = function() {
            screenImg.src = this.src; // Solo ora la mostriamo a video
            statusText.innerText = "Online";
            statusText.style.color = "#00ffcc";
            
            // Aspetta il tempo stabilito e poi chiedi il prossimo frame
            setTimeout(updateFrame, REFRESH_RATE);
        };

        // Se il server dà errore (es. file occupato, 404, o crash CGI)
        nextFrame.onerror = function() {
            statusText.innerText = "Retrying...";
            statusText.style.color = "#ff4444";
            
            // Riprova tra mezzo secondo (non martellare il server se ha problemi)
            setTimeout(updateFrame, 500);
        };

        // Avvia la richiesta GET aggiungendo il timestamp per evitare la cache
        nextFrame.src = IMAGE_URL + "?t=" + Date.now();
    }

    // Avvio del loop al caricamento della pagina
    window.onload = updateFrame;
</script>

</body>
</html>